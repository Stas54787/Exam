<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=3.0" />
    <title>Финальное тестирование</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 16px;
        height: 100%;
      }

      body {
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f1f1f1 0%, #d2d2d2 100%);
        min-height: 100vh;
        min-height: 100dvh; /* Динамическая высота viewport */
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: min(2vw, 20px);
        margin: 0;
        box-sizing: border-box;
        overflow-x: hidden;
        line-height: 1.6;
      }

      .container {
        background: #ffffff;
        border-radius: clamp(12px, 3vw, 24px);
        padding: clamp(16px, 4vw, 40px) clamp(12px, 3vw, 32px);
        box-shadow: 0 32px 64px rgba(19, 9, 9, 0.08),
          0 16px 32px rgba(19, 9, 9, 0.04);
        max-width: min(1200px, 95vw);
        width: 100%;
        min-height: auto;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: stretch;
        border: 1px solid rgba(210, 210, 210, 0.3);
        position: relative;
        overflow: visible;
        box-sizing: border-box;
        margin: clamp(8px, 2vh, 20px) auto;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: clamp(2px, 0.5vw, 4px);
        background: linear-gradient(90deg, #fc403a 0%, #130909 100%);
        border-radius: clamp(12px, 3vw, 24px) clamp(12px, 3vw, 24px) 0 0;
      }

      h1 {
        text-align: center;
        color: #130909;
        margin-bottom: clamp(20px, 4vh, 40px);
        font-size: clamp(1.2rem, 4vw, 2.25rem);
        font-weight: 800;
        letter-spacing: -0.025em;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(8px, 2vw, 16px);
        flex-wrap: wrap;
        line-height: 1.2;
      }

      .loader {
        width: fit-content;
        font-weight: bold;
        font-family: monospace;
        font-size: clamp(20px, 5vw, 30px);
        animation: l26 2s infinite;
      }
      .loader::before {
        content: "Loading...";
      }

      @keyframes l26 {
        0%,
        10% {
          transform: perspective(200px) rotateX(0) rotateY(0) scale(1);
        }
        30%,
        36% {
          transform: perspective(200px) rotateX(180deg) rotateY(0) scale(1);
        }
        63%,
        69% {
          transform: perspective(200px) rotateX(180deg) rotateY(180deg) scale(1);
        }
        90%,
        100% {
          transform: perspective(200px) rotateX(180deg) rotateY(180deg)
            scale(-1);
        }
      }

      .logo {
        width: clamp(32px, 8vw, 64px);
        height: clamp(32px, 8vw, 64px);
        border-radius: clamp(6px, 2vw, 12px);
        box-shadow: 0 8px 24px rgba(252, 64, 58, 0.2);
        object-fit: cover;
      }

      .progress-section {
        margin-bottom: clamp(16px, 4vh, 32px);
      }

      .progress-bar {
        background: #f1f1f1;
        border-radius: clamp(8px, 2vw, 16px);
        height: clamp(8px, 2vw, 12px);
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(19, 9, 9, 0.06);
      }

      .progress-fill {
        background: linear-gradient(90deg, #fc403a 0%, #130909 100%);
        height: 100%;
        border-radius: clamp(8px, 2vw, 16px);
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        width: 0%;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 20px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2)
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-20px);
        }
        100% {
          transform: translateX(100px);
        }
      }

      .stats {
        background: linear-gradient(135deg, #f1f1f1 0%, #ffffff 100%);
        padding: clamp(16px, 3vw, 24px);
        border-radius: clamp(12px, 3vw, 20px);
        margin-bottom: clamp(20px, 4vh, 40px);
        border: 1px solid #d2d2d2;
      }

      .stats h3 {
        color: #130909;
        margin-bottom: clamp(12px, 3vh, 20px);
        font-size: clamp(1rem, 3vw, 1.25rem);
        font-weight: 700;
        text-align: center;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(clamp(120px, 25vw, 160px), 1fr));
        gap: clamp(8px, 2vw, 16px);
        width: 100%;
      }

      .stat-item {
        background: #ffffff;
        padding: clamp(12px, 3vw, 20px);
        border-radius: clamp(8px, 2vw, 16px);
        text-align: center;
        border: 1px solid #f1f1f1;
        box-shadow: 0 4px 12px rgba(19, 9, 9, 0.04);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        min-height: clamp(80px, 15vw, 120px);
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .stat-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(19, 9, 9, 0.08);
      }

      .stat-number {
        font-size: clamp(1.5rem, 5vw, 2.5rem);
        font-weight: 800;
        color: #fc403a;
        line-height: 1;
        margin-bottom: 4px;
      }

      .stat-label {
        color: #130909;
        font-size: clamp(0.75rem, 2.5vw, 0.875rem);
        font-weight: 500;
        opacity: 0.8;
      }

      .days-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(clamp(150px, 30vw, 200px), 1fr));
        gap: clamp(12px, 3vw, 20px);
        margin-bottom: clamp(16px, 4vh, 32px);
        width: 100%;
      }

      .day-card {
        background: linear-gradient(135deg, #fc403a 0%, #130909 100%);
        color: #ffffff;
        padding: clamp(16px, 4vw, 24px);
        border-radius: clamp(12px, 3vw, 20px);
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        border: 2px solid transparent;
        min-height: clamp(80px, 15vw, 120px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .day-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1) transparent
        );
        transition: left 0.5s ease;
      }

      .day-card:hover::before {
        left: 100%;
      }

      .day-card:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 20px 40px rgba(252, 64, 58, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .day-card.completed {
        background: linear-gradient(135deg, #130909 0%, #fc403a 100%);
      }

      .day-card.locked {
        background: linear-gradient(135deg, #d2d2d2 0%, #f1f1f1 100%);
        color: #130909;
        cursor: not-allowed;
        opacity: 0.7;
      }

      .day-card.locked:hover {
        transform: none;
        box-shadow: none;
      }

      .day-card h3 {
        font-size: clamp(1rem, 3vw, 1.375rem);
        margin-bottom: clamp(4px, 1vw, 8px);
        font-weight: 700;
      }

      .day-card p {
        font-size: clamp(0.8rem, 2.5vw, 0.9rem);
        opacity: 0.9;
        font-weight: 400;
      }

      .completion-badge {
        position: absolute;
        top: clamp(8px, 2vw, 12px);
        right: clamp(8px, 2vw, 12px);
        background: #ffffff;
        color: #130909;
        border-radius: 50%;
        width: clamp(20px, 5vw, 28px);
        height: clamp(20px, 5vw, 28px);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(0.7rem, 2vw, 0.875rem);
        font-weight: 700;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .exam-section {
        display: none;
        animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .question-card {
        background: #ffffff;
        border-radius: clamp(12px, 3vw, 20px);
        padding: clamp(20px, 4vw, 32px);
        margin-bottom: clamp(16px, 3vh, 24px);
        border: 1px solid #f1f1f1;
        box-shadow: 0 8px 24px rgba(19, 9, 9, 0.06);
        position: relative;
      }

      .question-type {
        background: #fc403a;
        color: #ffffff;
        padding: clamp(6px, 1.5vw, 8px) clamp(12px, 3vw, 16px);
        border-radius: clamp(8px, 2vw, 12px);
        font-size: clamp(0.75rem, 2.5vw, 0.875rem);
        display: inline-block;
        margin-bottom: clamp(12px, 3vh, 20px);
        font-weight: 600;
        letter-spacing: 0.025em;
      }

      .question-text {
        font-size: clamp(1rem, 3vw, 1.125rem);
        line-height: 1.7;
        color: #130909;
        margin-bottom: clamp(16px, 3vh, 24px);
        font-weight: 400;
      }

      .evaluator-section {
        background: linear-gradient(135deg, #f1f1f1 0%, #ffffff 100%);
        border-radius: clamp(12px, 3vw, 20px);
        padding: clamp(20px, 4vw, 32px);
        margin-top: clamp(16px, 3vh, 24px);
        text-align: center;
        border: 2px solid #fc403a;
        box-shadow: 0 12px 32px rgba(252, 64, 58, 0.08);
      }

      .evaluator-title {
        color: #130909;
        font-size: clamp(1rem, 3vw, 1.25rem);
        margin-bottom: clamp(16px, 3vh, 24px);
        font-weight: 700;
      }

      .evaluation-buttons {
        display: flex;
        gap: clamp(12px, 3vw, 20px);
        justify-content: center;
        margin-bottom: clamp(12px, 3vh, 20px);
        flex-wrap: wrap;
      }

      .btn-correct, .btn-incorrect {
        color: #ffffff;
        padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4vw, 24px);
        border: none;
        border-radius: clamp(8px, 2vw, 12px);
        cursor: pointer;
        font-size: clamp(0.875rem, 2.5vw, 1rem);
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: clamp(120px, 25vw, 140px);
        position: relative;
        overflow: hidden;
      }

      .btn-correct {
        background: #28a745;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
      }

      .btn-incorrect {
        background: #fc403a;
        box-shadow: 0 4px 12px rgba(252, 64, 58, 0.3);
      }

      .btn-correct::before, .btn-incorrect::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .btn-correct:hover::before, .btn-incorrect:hover::before {
        left: 100%;
      }

      .btn-correct:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
      }

      .btn-incorrect:hover {
        background: #130909;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(19, 9, 9, 0.4);
      }

      .evaluation-result {
        display: none;
        padding: clamp(12px, 3vw, 16px);
        border-radius: clamp(8px, 2vw, 12px);
        margin-bottom: clamp(12px, 3vh, 20px);
        font-weight: 600;
        font-size: clamp(0.875rem, 2.5vw, 1rem);
      }

      .result-correct {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .result-incorrect {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .button-group {
        display: flex;
        gap: clamp(12px, 3vw, 16px);
        flex-wrap: wrap;
        justify-content: center;
        margin-top: clamp(20px, 4vh, 32px);
      }

      .btn {
        padding: clamp(12px, 3vw, 14px) clamp(20px, 4vw, 28px);
        border: none;
        border-radius: clamp(8px, 2vw, 12px);
        cursor: pointer;
        font-size: clamp(0.875rem, 2.5vw, 1rem);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
        min-width: clamp(140px, 30vw, 180px);
        position: relative;
        overflow: hidden;
        text-align: center;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary, .btn-success {
        background: #fc403a;
        color: #ffffff;
        box-shadow: 0 4px 12px rgba(252, 64, 58, 0.3);
      }

      .btn-primary:hover, .btn-success:hover {
        background: #130909;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(19, 9, 9, 0.3);
      }

      .btn-primary:disabled, .btn-success:disabled {
        background: #d2d2d2;
        color: #130909;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      .btn-primary:disabled::before, .btn-success:disabled::before {
        display: none;
      }

      .btn-secondary {
        background: #ffffff;
        color: #130909;
        border: 2px solid #fc403a;
        box-shadow: 0 4px 12px rgba(252, 64, 58, 0.1);
      }

      .btn-secondary:hover {
        background: #fc403a;
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(252, 64, 58, 0.3);
      }

      .back-btn {
        position: absolute;
        top: clamp(16px, 3vw, 24px);
        left: clamp(16px, 3vw, 24px);
        background: rgba(252, 64, 58, 0.1);
        border: 1px solid #fc403a;
        border-radius: clamp(8px, 2vw, 12px);
        padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px);
        font-size: clamp(0.875rem, 2.5vw, 1rem);
        cursor: pointer;
        color: #fc403a;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
      }

      .back-btn:hover {
        background: #fc403a;
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(252, 64, 58, 0.3);
      }

      .celebration {
        text-align: center;
        animation: celebrate 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .score-display {
        background: linear-gradient(135deg, #fc403a 0%, #130909 100%);
        color: #ffffff;
        padding: clamp(16px, 3vw, 20px);
        border-radius: clamp(12px, 3vw, 16px);
        margin-bottom: clamp(16px, 3vh, 24px);
        text-align: center;
        box-shadow: 0 8px 24px rgba(252, 64, 58, 0.3);
      }

      .score-display h4 {
        font-size: clamp(1rem, 3vw, 1.25rem);
        margin-bottom: clamp(6px, 1.5vh, 8px);
        font-weight: 600;
      }

      .score-numbers {
        font-size: clamp(1.5rem, 4vw, 2rem);
        font-weight: 800;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes celebrate {
        0%,
        100% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.05) rotate(1deg);
        }
        75% {
          transform: scale(1.05) rotate(-1deg);
        }
      }

      /* Дополнительные медиа-запросы для экстремальных размеров */
      @media (max-width: 320px) {
        html {
          font-size: 14px;
        }
        
        .container {
          padding: 12px 8px;
          margin: 4px auto;
        }
        
        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }
        
        .days-container {
          grid-template-columns: 1fr;
        }

        .evaluation-buttons {
          flex-direction: column;
          align-items: center;
        }
        
        .button-group {
          flex-direction: column;
          align-items: center;
        }
      }

      @media (min-width: 1400px) {
        html {
          font-size: 18px;
        }
      }

      @media (max-height: 600px) and (orientation: landscape) {
        body {
          align-items: flex-start;
          padding: 8px;
        }
        
        .container {
          margin: 4px auto;
          max-height: 95vh;
          overflow-y: auto;
        }
        
        h1 {
          margin-bottom: 16px;
        }
        
        .stats {
          margin-bottom: 20px;
        }
        
        .days-container {
          margin-bottom: 16px;
        }
      }

      /* Улучшения для очень широких экранов */
      @media (min-width: 1800px) {
        .container {
          max-width: 1400px;
        }
        
        .stats-grid {
          grid-template-columns: repeat(5, 1fr);
        }
        
        .days-container {
          grid-template-columns: repeat(5, 1fr);
        }
      }

      /* Оптимизация для принтера */
      @media print {
        body {
          background: white;
          padding: 0;
        }
        
        .container {
          box-shadow: none;
          border: 1px solid #ccc;
          max-width: 100%;
        }
        
        .btn, .back-btn {
          display: none;
        }
        
        .evaluation-buttons {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        <img
          src="https://i.postimg.cc/fb8Q8KFX/Whats-App-Image-2025-07-06-at-14-08-31.jpg"
          alt="Логотип компании"
          class="logo"
        />
         Финальное тестирование
      </h1>

      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <div class="stats">
        <h3>Статистика прохождения</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="completedDays">0</div>
            <div class="stat-label">Дней завершено</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="totalQuestions">0</div>
            <div class="stat-label">Вопросов пройдено</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="correctAnswers">0</div>
            <div class="stat-label">Правильных ответов</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="incorrectAnswers">0</div>
            <div class="stat-label">Неправильных ответов</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="successRate">0%</div>
            <div class="stat-label">Пройдено</div>
          </div>
        </div>
      </div>

      <div id="mainScreen">
        <div class="days-container">
          <div class="day-card" data-day="1">
            <h3>День 1</h3>
            <div class="completion-badge" style="display: none">✓</div>
          </div>
          <div class="day-card locked" data-day="2">
            <h3>День 2</h3>
            <div class="completion-badge" style="display: none">✓</div>
          </div>
          <div class="day-card locked" data-day="3">
            <h3>День 3</h3>
            <div class="completion-badge" style="display: none">✓</div>
          </div>
          <div class="day-card locked" data-day="4">
            <h3>День 4</h3>
            <div class="completion-badge" style="display: none">✓</div>
          </div>
          <div class="day-card locked" data-day="5">
            <h3>День 5</h3>
            <div class="completion-badge" style="display: none">✓</div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 24px">
          <button class="btn btn-secondary" onclick="resetTest()">
            Сбросить тест
          </button>
        </div>
      </div>

      <div id="examScreen" class="exam-section">
        <button class="back-btn" onclick="backToMain()">← Назад</button>

        <div id="questionContainer"></div>

        <div
          class="evaluator-section"
          id="evaluatorSection"
          style="display: none"
        >
          <div class="evaluator-title">📋 Оценка экзаменатора</div>
          <div class="evaluation-result" id="evaluationResult"></div>
          <div class="evaluation-buttons">
            <button class="btn-correct" onclick="evaluateAnswer(true)">
              ✅ Правильно
            </button>
            <button class="btn-incorrect" onclick="evaluateAnswer(false)">
              ❌ Неправильно
            </button>
          </div>
        </div>

        <div class="button-group">
          <button
            class="btn btn-primary"
            id="nextBtn"
            onclick="nextQuestion()"
            disabled
          >
            Следующий вопрос
          </button>
          <button
            class="btn btn-success"
            id="completeBtn"
            onclick="completeDay()"
            style="display: none"
            disabled
          >
            Завершить день
          </button>
          <button class="btn btn-secondary" onclick="backToMain()">
            Вернуться к выбору дня
          </button>
        </div>
      </div>
    </div>

    <script>
      const questions = {
        1: [
          {
            type: "Вопрос",
            text: "Где находится файл новичка, что он из себя представляет, как планируете его использовать с командой и самостоятельно?",
          },
          {
            type: "Вопрос",
            text: "Что такое стипендия для новичка и в какие дни она начисляется?",
          },
          {
            type: "Вопрос",
            text: "Опишите принцип взаимодействия с застройщиками: основные этапы и участники.",
          },
					{
            type: "Вопрос",
            text: "Как любого найти сотрудника с помощью телефонного справочника в системе космос? продемонстрируйте.",
          },
					{
            type: "Вопрос",
            text: "Вам нужно поставить встречу коллеге в гугл календаре, как это сделать? как посмотреть расписание в гугл календаре? продемонстрируйте.",
          },
        ],
        2: [
          {
            type: "Практический",
            text: "Как создать заявку на покупку через мобильное приложение? Покажите пошагово.",
          },
          {
            type: "Вопрос",
            text: "Опишите основные преимущества мобильного приложения РИЕС для риелтора и как планируете использовать?",
          },
          {
            type: "Вопрос",
            text: "Какие ресурсы можно использовать для поиска объектов недвижимости? Подробнее расскажите про 'Робин гуд' и 'Смарт агент'.",
          },
          {
            type: "Вопрос",
            text: "Где находится сервис Контур Реестро, что это такое и для чего он нужен?",
          },
          {
            type: "Практический",
            text: "Какими ресурсами пользуемся для добавления дома или участка в базу Космос? Продемонстрируйте процесс.",
          },
        ],
        3: [
          {
            type: "Вопрос",
            text: "Перечислите возможные способы привлечения покупателей. Какие из них вы бы использовали?",
          },
          {
            type: "Практический",
            text: "Как добавить покупателя в систему Космос? Покажите пошагово.",
          },
          {
            type: "Практический",
            text: "Как оформить заявку на ипотеку через мобильное приложение? Продемонстрируйте.",
          },
          {
            type: "Практический",
            text: "Как создать заявку на фотографирование объекта? Продемонстрируйте пошагово.",
          },
        ],
        4: [
          {
            type: "Практический",
            text: "С помощью какой таблицы можно выбрать объекты, находящиеся в ядре? Где она находится? Продемонстрируйте, как ей пользоваться.",
          },
          {
            type: "Практический",
            text: "Как зарегистрировать клиента в личном кабинете? Покажите пошаговую инструкцию и опишите, что такое личный кабинет клиента.",
          },
          {
            type: "Практический",
            text: "Как отправить агентский договор онлайн? Продемонстрируйте, как через приложение и через Космос отправить договор.",
          },
          {
            type: "Практический",
            text: "Как отправить подборку покупателю? Продемонстрируйте через приложение и через Космос.",
          },
        ],
        5: [
          {
            type: "Практический",
            text: "Как отметить показ через систему Космос, если у вас объект, покупатель, либо показ с другим агентством? Продемонстрируйте.",
          },
          {
            type: "Вопрос",
            text: "Что такое потери по покупателю, как работать с этим показателем и какой норматив по этому показателю?",
          },
          {
            type: "Вопрос",
            text: "Какой пакет документов необходим для оформления задатка?",
          },
          {
            type: "Вопрос",
            text: "Из чего складывается итоговый процент риелтора? Расскажите поэтапно и покажите где это посмотреть наглядно.",
          },
          {
            type: "Вопрос",
            text: "Как мы взаимодействуем с другими агентствами? Как называется документ, который нужно оформлять при сделках с другим АН, и где он находится?",
          },
          {
            type: "Вопрос",
            text: "По каким причинам может быть ротирована заявка? Опишите кратко регламент и где можно посмотреть наглядно?",
          },
        ],
      };

      let currentDay = 1;
      let currentQuestionIndex = 0;
      let completedDays = JSON.parse(
        localStorage.getItem("completedDays") || "[]"
      );
      let totalAnswered = parseInt(
        localStorage.getItem("totalAnswered") || "0"
      );
      let correctAnswers = parseInt(
        localStorage.getItem("correctAnswers") || "0"
      );
      let incorrectAnswers = parseInt(localStorage.getItem("incorrectAnswers") || "0");
      let currentDayCorrect = 0;
      let currentDayTotal = 0;
      let isQuestionEvaluated = false;

      // Глобальный массив для логирования ответов
      let answersLog = JSON.parse(localStorage.getItem("answersLog") || "[]");

      function initializeApp() {
        updateProgress();
        updateStats();
        updateDayCards();

        // Добавляем обработчики событий для карточек дней
        document.querySelectorAll(".day-card").forEach((card) => {
          card.addEventListener("click", function () {
            const day = parseInt(this.dataset.day);
            if (!this.classList.contains("locked")) {
              startExam(day);
            }
          });
        });
      }

      function updateProgress() {
        const progress = (completedDays.length / 5) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      function updateStats() {
        document.getElementById("completedDays").textContent = completedDays.length;
        document.getElementById("totalQuestions").textContent = totalAnswered;
        document.getElementById("correctAnswers").textContent = correctAnswers;
        document.getElementById("incorrectAnswers").textContent = incorrectAnswers;
        document.getElementById("successRate").textContent =
          totalAnswered > 0
            ? Math.round((correctAnswers / totalAnswered) * 100) + "%"
            : "0%";
      }

      function updateDayCards() {
        document.querySelectorAll(".day-card").forEach((card) => {
          const day = parseInt(card.dataset.day);

          // Сброс состояния
          card.classList.remove("completed", "locked");
          card.querySelector(".completion-badge").style.display = "none";

          if (completedDays.includes(day)) {
            card.classList.add("completed");
            card.querySelector(".completion-badge").style.display = "flex";
          } else if (day === 1 || completedDays.includes(day - 1)) {
            // Доступен для старта
          } else {
            card.classList.add("locked");
          }
        });
      }

      function startExam(day) {
        currentDay = day;
        currentQuestionIndex = 0;
        currentDayCorrect = 0;
        currentDayTotal = 0;
        isQuestionEvaluated = false;
        
        document.getElementById("mainScreen").style.display = "none";
        document.getElementById("examScreen").style.display = "block";
        showQuestion();
      }

      function showQuestion() {
        const dayQuestions = questions[currentDay];
        
        // Проверяем, есть ли вопросы для этого дня
        if (!dayQuestions) {
          console.error("Вопросы для дня " + currentDay + " не найдены");
          backToMain();
          return;
        }

        // Проверяем, не превышает ли индекс количество вопросов
        if (currentQuestionIndex >= dayQuestions.length) {
          console.error("Индекс вопроса превышает количество доступных вопросов");
          completeDay();
          return;
        }

        const question = dayQuestions[currentQuestionIndex];
        const questionContainer = document.getElementById("questionContainer");

        questionContainer.innerHTML = `
          <div class="question-card">
            <div class="question-type">
              ${question.type} вопрос ${currentQuestionIndex + 1}/${dayQuestions.length}
            </div>
            <div class="question-text">${question.text}</div>
          </div>
        `;

        // Показываем секцию оценки
        document.getElementById("evaluatorSection").style.display = "block";
        document.getElementById("evaluationResult").style.display = "none";

        // Сбрасываем состояние оценки
        isQuestionEvaluated = false;
        
        // Управление кнопками
        const nextBtn = document.getElementById("nextBtn");
        const completeBtn = document.getElementById("completeBtn");
        
        nextBtn.disabled = true;
        completeBtn.disabled = true;

        // Показываем нужную кнопку
        if (currentQuestionIndex < dayQuestions.length - 1) {
          nextBtn.style.display = "inline-block";
          completeBtn.style.display = "none";
        } else {
          nextBtn.style.display = "none";
          completeBtn.style.display = "inline-block";
        }
      }

      function nextQuestion() {
        if (!isQuestionEvaluated) {
          alert("Пожалуйста, сначала оцените ответ");
          return;
        }

        currentQuestionIndex++;
        showQuestion();
      }

      function evaluateAnswer(isCorrect) {
        if (isQuestionEvaluated) return;

        isQuestionEvaluated = true;
        currentDayTotal++;
        totalAnswered++;

        const dayQuestions = questions[currentDay];
        const question = dayQuestions[currentQuestionIndex];

        answersLog.push({
          day: currentDay,
          question: question.text,
          result: isCorrect ? "Правильно" : "Неправильно",
          timestamp: new Date().toISOString()
        });

        localStorage.setItem("answersLog", JSON.stringify(answersLog));

        const resultDiv = document.getElementById("evaluationResult");
        if (isCorrect) {
          currentDayCorrect++;
          correctAnswers++;
          resultDiv.textContent = "✅ Ответ засчитан как правильный";
          resultDiv.className = "evaluation-result result-correct";
        } else {
          incorrectAnswers++;
          resultDiv.textContent = "❌ Ответ засчитан как неправильный";
          resultDiv.className = "evaluation-result result-incorrect";
        }
        resultDiv.style.display = "block";

        document.getElementById("nextBtn").disabled = false;
        document.getElementById("completeBtn").disabled = false;

        localStorage.setItem("totalAnswered", totalAnswered.toString());
        localStorage.setItem("correctAnswers", correctAnswers.toString());
        localStorage.setItem("incorrectAnswers", incorrectAnswers.toString());

        updateStats();
      }

      function completeDay() {
        if (!isQuestionEvaluated) {
          alert("Пожалуйста, сначала оцените последний ответ");
          return;
        }

        // Добавляем день в завершенные, если его там еще нет
        if (!completedDays.includes(currentDay)) {
          completedDays.push(currentDay);
          localStorage.setItem("completedDays", JSON.stringify(completedDays));
        }

        // Показываем результаты дня
        showDayResults();
      }

      function showDayResults() {
        const questionContainer = document.getElementById("questionContainer");
        const percentage = currentDayTotal > 0 ? Math.round((currentDayCorrect / currentDayTotal) * 100) : 0;

        questionContainer.innerHTML = `
          <div class="question-card celebration">
            <h2 style="color: #FC403A; margin-bottom: 20px;">🎉 День ${currentDay} завершен!</h2>
            <div class="score-display" style="background: ${percentage >= 70 ? "#28a745" : "#FC403A"}; margin: 20px 0;">
              <h4>Результат за день</h4>
              <div class="score-numbers">${currentDayCorrect}/${currentDayTotal} (${percentage}%)</div>
            </div>
            <p style="font-size: 1.125rem; color: #130909; margin-bottom: 15px;">
              ${percentage >= 70 ? "Отличный результат! " : "Нужно подтянуть знания. "}
              ${completedDays.length === 5 ? "Весь курс пройден!" : "Вернитесь к выбору дня для продолжения."}
            </p>
            <div style="margin-top: 20px;">
              <button class="btn btn-primary" onclick="downloadDayResults()">Скачать результаты дня</button>
              <button class="btn btn-secondary" onclick="backToMain()">Вернуться к выбору дней</button>
              ${completedDays.length === 5 ? '<button class="btn btn-success" onclick="showFinalResults()">Посмотреть итоговые результаты</button>' : ''}
            </div>
          </div>
        `;

        // Скрываем секцию оценки и кнопки навигации
        document.getElementById("evaluatorSection").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("completeBtn").style.display = "none";
      }

      function downloadDayResults() {
        // Фильтруем ответы только для текущего дня
        const dayAnswers = answersLog.filter(entry => entry.day === currentDay);
        
        // Формируем CSV
        const csvRows = [["День", "Вопрос", "Результат", "Время"]];
        dayAnswers.forEach((entry) => {
          csvRows.push([
            entry.day,
            `"${entry.question.replace(/"/g, '""')}"`,
            entry.result,
            entry.timestamp || ''
          ]);
        });
        
        const csvContent = csvRows.map(row => row.join(",")).join("\n");
        downloadCSV(csvContent, `Результаты_День_${currentDay}`);
      }

      function downloadAllResults() {
        // Формируем CSV для всех ответов
        const csvRows = [["День", "Вопрос", "Результат", "Время"]];
        answersLog.forEach((entry) => {
          csvRows.push([
            entry.day,
            `"${entry.question.replace(/"/g, '""')}"`,
            entry.result,
            entry.timestamp || ''
          ]);
        });
        
        const csvContent = csvRows.map(row => row.join(",")).join("\n");
        downloadCSV(csvContent, "Результаты_всех_дней");
      }

      function downloadCSV(csvContent, baseFileName) {
        try {
          // Добавляем BOM для корректного отображения кириллицы
          const BOM = '\uFEFF';
          const csvWithBOM = BOM + csvContent;
          
          const now = new Date();
          const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;
          const fileName = `${baseFileName}_${timestamp}.csv`;

          // Проверяем доступность различных методов скачивания
          if (typeof window.showSaveFilePicker === 'function') {
            // Новый File System Access API (для современных браузеров)
            downloadWithFileSystemAPI(csvWithBOM, fileName);
          } else if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            // Для Internet Explorer
            const blob = new Blob([csvWithBOM], { type: "text/csv;charset=utf-8;" });
            window.navigator.msSaveOrOpenBlob(blob, fileName);
            alert("Файл успешно скачан!");
          } else {
            // Традиционный метод для всех остальных браузеров
            downloadWithTraditionalMethod(csvWithBOM, fileName);
          }
        } catch (error) {
          console.error("Ошибка при скачивании файла:", error);
          // Fallback метод
          fallbackDownload(csvContent, baseFileName);
        }
      }

      async function downloadWithFileSystemAPI(content, fileName) {
        try {
          const fileHandle = await window.showSaveFilePicker({
            suggestedName: fileName,
            types: [{
              description: 'CSV files',
              accept: { 'text/csv': ['.csv'] }
            }]
          });
          
          const writable = await fileHandle.createWritable();
          await writable.write(content);
          await writable.close();
          
          alert("Файл успешно сохранен!");
        } catch (error) {
          if (error.name !== 'AbortError') {
            console.error("Ошибка File System API:", error);
            // Переходим к традиционному методу
            downloadWithTraditionalMethod(content, fileName);
          }
        }
      }

      function downloadWithTraditionalMethod(content, fileName) {
        try {
          const blob = new Blob([content], { type: "text/csv;charset=utf-8;" });
          
          // Множественная проверка совместимости
          if (typeof URL !== 'undefined' && URL.createObjectURL) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            
            // Дополнительные атрибуты для совместимости с Arc
            link.href = url;
            link.download = fileName;
            link.rel = "noopener";
            link.target = "_blank";
            link.style.display = "none";
            
            // Добавляем событие для обработки клика
            link.addEventListener('click', function(e) {
              // Небольшая задержка для Arc
              setTimeout(() => {
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
              }, 100);
            });
            
            document.body.appendChild(link);
            
            // Эмулируем клик пользователя для Arc
            const clickEvent = new MouseEvent('click', {
              view: window,
              bubbles: true,
              cancelable: true
            });
            
            link.dispatchEvent(clickEvent);
            
            // Альтернативный метод клика
            if (link.click) {
              link.click();
            }
            
            alert("Файл готов к скачиванию!");
          } else {
            throw new Error("URL.createObjectURL не поддерживается");
          }
        } catch (error) {
          console.error("Ошибка традиционного метода:", error);
          fallbackDownload(content.replace('\uFEFF', ''), fileName);
        }
      }

      function fallbackDownload(csvContent, baseFileName) {
        try {
          // Последний резервный метод - показываем контент в новом окне
          const now = new Date();
          const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;
          
          const newWindow = window.open('', '_blank');
          if (newWindow) {
            newWindow.document.write(`
              <html>
                <head>
                  <title>Результаты тестирования - ${baseFileName}</title>
                  <meta charset="utf-8">
                </head>
                <body>
                  <h2>Результаты тестирования</h2>
                  <p>Скопируйте текст ниже и сохраните в файл с расширением .csv:</p>
                  <textarea style="width:100%; height:400px; font-family:monospace;">${csvContent}</textarea>
                  <br><br>
                  <button onclick="navigator.clipboard.writeText(document.querySelector('textarea').value).then(() => alert('Скопировано в буфер обмена!'))">
                    Копировать в буфер обмена
                  </button>
                </body>
              </html>
            `);
            newWindow.document.close();
            alert("Скачивание недоступно. Данные открыты в новом окне для копирования.");
          } else {
            // Если даже новое окно заблокировано
            const textArea = document.createElement('textarea');
            textArea.value = csvContent;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
              const successful = document.execCommand('copy');
              if (successful) {
                alert("Данные скопированы в буфер обмена! Вставьте их в текстовый редактор и сохраните как .csv файл.");
              } else {
                alert("Не удалось скопировать автоматически. Попробуйте использовать Ctrl+C для копирования.");
              }
            } catch (err) {
              alert("Автоматическое копирование недоступно. Данные выведены в консоль.");
              console.log("CSV данные:", csvContent);
            }
            
            document.body.removeChild(textArea);
          }
        } catch (error) {
          console.error("Ошибка fallback метода:", error);
          alert("Не удалось скачать файл. Данные выведены в консоль браузера (F12 -> Console)");
          console.log("CSV данные:", csvContent);
        }
      }

      function showFinalResults() {
        const percent = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;

        document.getElementById("mainScreen").style.display = "none";
        document.getElementById("examScreen").style.display = "none";

        const container = document.querySelector(".container");
        container.innerHTML = `
          <div class="question-card celebration" style="margin-top: 40px;">
            <h2 style="color: #FC403A; margin-bottom: 20px;">🎉 Весь тест завершен!</h2>
            <div class="score-display" style="background: ${percent >= 70 ? "#28a745" : "#FC403A"}; margin: 20px 0;">
              <h4>Итоговая статистика</h4>
              <div class="score-numbers">${correctAnswers}/${totalAnswered} (${percent}%)</div>
            </div>
            <div style="font-size: 1.1rem; color: #130909; margin-bottom: 20px;">
              Завершено дней: <b>${completedDays.length}/5</b><br>
              Всего вопросов: <b>${totalAnswered}</b><br>
              Правильных ответов: <b>${correctAnswers}</b><br>
              Пройдено: <b>${percent}%</b>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="downloadAllResults()">Скачать все результаты</button>
              <button class="btn btn-secondary" onclick="resetTest()">Сбросить тест</button>
              <button class="btn btn-success" onclick="location.reload()">Вернуться к началу</button>
            </div>
          </div>
        `;
      }

      function backToMain() {
        document.getElementById("examScreen").style.display = "none";
        document.getElementById("mainScreen").style.display = "block";

        updateProgress();
        updateStats();
        updateDayCards();
      }

      function resetTest() {
        if (confirm("Вы уверены, что хотите сбросить весь прогресс?")) {
          localStorage.removeItem("completedDays");
          localStorage.removeItem("totalAnswered");
          localStorage.removeItem("correctAnswers");
          localStorage.removeItem("answersLog");
          
          // Сбрасываем глобальные переменные
          answersLog = [];
          completedDays = [];
          totalAnswered = 0;
          correctAnswers = 0;
          currentDay = 1;
          currentQuestionIndex = 0;
          currentDayCorrect = 0;
          currentDayTotal = 0;
          isQuestionEvaluated = false;
          
          // Перезагружаем страницу для полного сброса
          location.reload();
        }
      }

      // Инициализация при загрузке страницы
      document.addEventListener("DOMContentLoaded", function() {
        initializeApp();
      });
    </script>
  </body>
</html>
